# Optical flow
光学流动。

## 概念
光学移动连续两帧之间由于物体或相机移动图片表现运动模式。是2D向量场，每个向量位移表示为一帧到另一帧中点的移动。看下面的图:

<image src="image/02-01.jpg"/>

显示一个球儿在5个连续帧的移动。箭头表示位移的方向。光学流动有很多应用场合，比如:

* 运动构建
* 视频压缩
* 视频稳定技术

**光学流动的几个假设**:

* 1.两帧之间物体像素密度不变
* 2.相邻像素之间有相似的运动

## 原理

考虑第一帧一个像素点I(x,y,t)（检测新尺寸，需要时间。我们现在只处理图片，现在不需要时间）。dt时间后在下一帧的移动距离是(dx,dy)。所以这些像素一样的并且密度不变，所以我们认为:

<image src="image/02-02.png"/>

右边等式，Taylor展开。去掉常数项，除以dt得到下面等式:

<image src="image/02-03.png"/>
其中：

<image src="image/02-04.png"/>

上面等式称为光学流动等式。里面我们能找到fx和fy，他们是图片梯度。同样ft是沿着时间的梯度。但是(u,v)是未知的。我们不能皆苦一个等式有两个位置变量。这个问题有许多解决方法，如Lucas-Kanade

## Lucas-Kanade 方法
之前已经进行假设，所有相邻像素由相似的移动。Lucas-Kanade方法采用点周围采用3x3path。所以所有9个点有相似的运动。能够找到9个点中(fx,fy,ft)。现在我们问题变成，解决9个等式有两个位置变量问题，过约束问题。更好的方式是采用最小二乘法。下面是最终结果两个未知数两个方程得到的解：

<image src="image/02-05.png"/>
检查逆矩阵与Harris角检测的相似性。表明角点用来更好的追踪。

这个观点来看，我们采用一些点来观察，我们收到这些点光学流动。但是又有一些问题。直到现在我们处理小的运动。当大的运动将会失效。然后我们又要使用金字塔图。当我们在塔图中，小的运动被移除掉，大的运动变成小的运动。从这用Lucas-Kanade，能获得带有不同缩放的光学流动。